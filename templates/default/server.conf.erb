<% # unless templating via a role, use a sane et of defaults -%>
<% if node['logstash']['server']['inputs'].empty? and node['logstash']['server']['filters'].empty? \
     and node['logstash']['server']['outputs'].empty? -%>

input {
  tcp {
    type => "tcp-input"
    port => "5959"
    format => "json_event"
  }

output {
	stdout { debug => true debug_format => "json" }

	<% if @enable_embedded_es -%>
	elasticsearch { embedded => true }
	<% else -%>
	elasticsearch { host => "<%= @es_server_ip %>" cluster => "<%= @es_cluster %>" }
	<% end -%>

	<% unless @graphite_server_ip.empty? -%>
	graphite { host => "<%= @graphite_server_ip %>" metrics => ["logstash.events", "1"] }
	<% end -%>
}

<% else -%>

input {
    <%= hash_to_stash(node['logstash']['server']['inputs']) %>
}

<% unless  node['logstash']['server']['filters'].empty? -%>
filter {
   <%= hash_to_stash(node['logstash']['server']['filters'])%>
}
<% end -%>

output {
      <%= hash_to_stash(node['logstash']['server']['outputs']) %>
}

<% end -%>
