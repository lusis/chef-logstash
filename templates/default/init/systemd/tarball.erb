<% @full_java_opts = [
  "-Xms#{@min_heap}",
  "-Xmx#{@max_heap}",
  "-XX:+UseParNewGC",
  "-XX:+UseConcMarkSweepGC",
  "-Djava.awt.headless=true",
  "-XX:CMSInitiatingOccupancyFraction=75",
  "-XX:+UseCMSInitiatingOccupancyOnly",
  "-Djava.io.tmpdir=#{@home}/tmp/"
  ]
  
  @full_java_opts << "-Djava.net.preferIPv4Stack=true" if @ipv4_only
  @full_java_opts << @java_opts.strip.gsub("  "," ") unless @java_opts.nil? || @java_opts.empty?
%>
[Unit]
Description=logstash
After=network.target

[Service]
User=<%= @user %>
Group=<%= @supervisor_gid %>
WorkingDirectory=<%= @home %>
LimitNOFILE=<%= @nofile_hard %>
Environment="LOGSTASH_HOME=<%= @home %>"
Environment="HOME=<%= @home %>"
Environment="LS_HEAP_SIZE=<%= @max_heap %>"
Environment="HEAP_DUMP_PATH=-XX:HeapDumpPath=<%= @home %>/heapdump.hprof"
Environment="GC_OPTS=<%= @gc_opts %>"
Environment="JAVA_OPTS=<%=@full_java_opts.join(' ')%>"
ExecStart=<%= @home %>/bin/logstash <%= @args.join(' ') %>
Restart=on-failure
RestartSec=30
SyslogIdentifier=logstash_<%= @name %>

[Install]
WantedBy=multi-user.target